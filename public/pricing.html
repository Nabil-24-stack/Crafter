<!DOCTYPE html>
<html lang="en" class="dark">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Crafter - Pricing</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          colors: {
            primary: '#36E4D8',
            'primary-hover': '#2BC9BE',
            border: 'hsl(240 3.7% 15.9%)',
            input: 'hsl(240 3.7% 15.9%)',
            ring: 'hsl(240 4.9% 83.9%)',
            background: 'hsl(240 10% 3.9%)',
            foreground: 'hsl(0 0% 98%)',
            card: 'hsl(240 10% 3.9%)',
            'card-foreground': 'hsl(0 0% 98%)',
            popover: 'hsl(240 10% 3.9%)',
            'popover-foreground': 'hsl(0 0% 98%)',
            secondary: 'hsl(240 3.7% 15.9%)',
            'secondary-foreground': 'hsl(0 0% 98%)',
            muted: 'hsl(240 3.7% 15.9%)',
            'muted-foreground': 'hsl(240 5% 64.9%)',
            accent: 'hsl(240 3.7% 15.9%)',
            'accent-foreground': 'hsl(0 0% 98%)',
            destructive: 'hsl(0 62.8% 30.6%)',
            'destructive-foreground': 'hsl(0 0% 98%)',
          }
        }
      }
    }
  </script>
  <style>
    .gradient-border {
      position: relative;
      background: linear-gradient(hsl(240 10% 3.9%), hsl(240 10% 3.9%)) padding-box,
                  linear-gradient(135deg, #36E4D8, #2BC9BE) border-box;
      border: 2px solid transparent;
    }

    @keyframes shimmer {
      0% { background-position: -1000px 0; }
      100% { background-position: 1000px 0; }
    }

    .shine {
      background: linear-gradient(90deg, transparent, rgba(54, 228, 216, 0.1), transparent);
      background-size: 200% 100%;
      animation: shimmer 3s infinite;
    }
  </style>
</head>
<body class="bg-background text-foreground antialiased min-h-screen">
  <div class="container mx-auto px-4 py-16 max-w-7xl">
    <!-- Header -->
    <div class="text-center mb-16 space-y-4">
      <div class="inline-block">
        <h1 class="text-5xl md:text-6xl font-bold bg-gradient-to-r from-white to-gray-400 bg-clip-text text-transparent mb-2">
          Choose Your Plan
        </h1>
        <div class="h-1 w-32 mx-auto bg-gradient-to-r from-primary to-primary-hover rounded-full"></div>
      </div>
      <p class="text-xl text-muted-foreground max-w-2xl mx-auto">
        Get started with AI-powered design iteration today
      </p>
    </div>

    <!-- Pricing Cards -->
    <div class="grid md:grid-cols-2 gap-8 mb-20 max-w-5xl mx-auto">
      <!-- Free Plan -->
      <div class="relative group">
        <div class="bg-secondary border border-border rounded-xl p-8 hover:border-muted transition-all duration-300">
          <div class="space-y-6">
            <div>
              <h3 class="text-2xl font-semibold mb-2">Free</h3>
              <div class="flex items-baseline gap-2 mb-3">
                <span class="text-5xl font-bold">$0</span>
                <span class="text-muted-foreground">AUD / month</span>
              </div>
              <p class="text-muted-foreground">Perfect for trying out Crafter</p>
            </div>

            <ul class="space-y-3">
              <li class="flex items-start gap-3">
                <svg class="w-5 h-5 text-primary mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                </svg>
                <span class="text-sm">10 iterations per month</span>
              </li>
              <li class="flex items-start gap-3">
                <svg class="w-5 h-5 text-primary mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                </svg>
                <span class="text-sm">Gemini AI model only</span>
              </li>
              <li class="flex items-start gap-3">
                <svg class="w-5 h-5 text-primary mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                </svg>
                <span class="text-sm">Maximum 3 variations per iteration</span>
              </li>
              <li class="flex items-start gap-3">
                <svg class="w-5 h-5 text-primary mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                </svg>
                <span class="text-sm">Single frame only</span>
              </li>
              <li class="flex items-start gap-3">
                <svg class="w-5 h-5 text-primary mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                </svg>
                <span class="text-sm">Community support</span>
              </li>
              <li class="flex items-start gap-3 invisible">
                <svg class="w-5 h-5 text-primary mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                </svg>
                <span class="text-sm">Spacer</span>
              </li>
            </ul>

            <button id="free-btn" disabled class="w-full py-3 px-6 rounded-lg border border-border bg-secondary text-muted-foreground font-medium cursor-not-allowed">
              Current Plan
            </button>
          </div>
        </div>
      </div>

      <!-- Pro Plan -->
      <div class="relative group">
        <div class="absolute -inset-0.5 bg-gradient-to-r from-primary to-primary-hover rounded-xl opacity-75 group-hover:opacity-100 transition duration-300 blur"></div>
        <div class="relative bg-secondary border border-primary/50 rounded-xl p-8">
          <div class="absolute top-0 right-8 transform -translate-y-1/2">
            <span class="inline-flex items-center px-4 py-1.5 rounded-full text-xs font-semibold bg-gradient-to-r from-primary to-primary-hover text-black">
              POPULAR
            </span>
          </div>

          <div class="space-y-6">
            <div>
              <h3 class="text-2xl font-semibold mb-2">Pro</h3>
              <div class="flex items-baseline gap-2 mb-3">
                <span class="text-5xl font-bold bg-gradient-to-r from-primary to-primary-hover bg-clip-text text-transparent">$18</span>
                <span class="text-muted-foreground">AUD / month</span>
              </div>
              <p class="text-muted-foreground">For professional designers who iterate frequently</p>
            </div>

            <ul class="space-y-3">
              <li class="flex items-start gap-3">
                <svg class="w-5 h-5 text-primary mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                </svg>
                <span class="text-sm">40 iterations per month</span>
              </li>
              <li class="flex items-start gap-3">
                <svg class="w-5 h-5 text-primary mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                </svg>
                <span class="text-sm">Both Claude Sonnet 4.5 & Gemini AI</span>
              </li>
              <li class="flex items-start gap-3">
                <svg class="w-5 h-5 text-primary mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                </svg>
                <span class="text-sm">Maximum 10 variations per iteration</span>
              </li>
              <li class="flex items-start gap-3">
                <svg class="w-5 h-5 text-primary mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                </svg>
                <span class="text-sm">Multi-frame flows supported</span>
              </li>
              <li class="flex items-start gap-3">
                <svg class="w-5 h-5 text-primary mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                </svg>
                <span class="text-sm">Priority support</span>
              </li>
              <li class="flex items-start gap-3">
                <svg class="w-5 h-5 text-primary mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                </svg>
                <span class="text-sm">Early access to new features</span>
              </li>
            </ul>

            <button id="subscribe-btn" onclick="subscribeToPro()" class="w-full py-3 px-6 rounded-lg bg-gradient-to-r from-primary to-primary-hover hover:opacity-90 text-black font-semibold transition-all duration-300 transform hover:scale-[1.02] active:scale-[0.98]">
              Upgrade to Pro
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Iteration Packs -->
    <div id="iteration-packs" class="max-w-5xl mx-auto">
      <div class="bg-secondary border border-border rounded-xl p-8 md:p-10">
        <div class="text-center mb-10">
          <h2 class="text-3xl md:text-4xl font-bold mb-3">Need More Iterations?</h2>
          <p class="text-muted-foreground">One-time iteration packs available anytime</p>
        </div>

        <div class="space-y-4">
          <!-- 10 Pack -->
          <div class="bg-background/50 border border-border rounded-lg p-5 flex items-center justify-between hover:border-primary/30 transition-all duration-300 group">
            <div class="flex items-center gap-4">
              <div>
                <div class="text-xl font-bold flex items-baseline gap-2">
                  <span class="italic">10 Iterations</span>
                  <span class="text-sm text-muted-foreground font-normal">Starter pack</span>
                </div>
              </div>
            </div>
            <div class="flex items-center gap-6">
              <div class="text-2xl font-bold">$5 <span class="text-base text-muted-foreground">AUD</span></div>
              <button onclick="buyPack(10)" class="px-6 py-2.5 rounded-lg border border-border bg-background hover:bg-muted text-foreground font-medium transition-all duration-300">
                Buy Pack
              </button>
            </div>
          </div>

          <!-- 20 Pack -->
          <div class="bg-background/50 border border-border rounded-lg p-5 flex items-center justify-between hover:border-primary/30 transition-all duration-300 group">
            <div class="flex items-center gap-4">
              <div>
                <div class="text-xl font-bold flex items-baseline gap-2">
                  <span class="italic">20 Iterations</span>
                  <span class="inline-flex items-center px-2.5 py-0.5 rounded text-xs font-semibold bg-green-500/20 text-green-400 border border-green-500/30 ml-2">
                    SAVE 10%
                  </span>
                </div>
              </div>
            </div>
            <div class="flex items-center gap-6">
              <div class="text-2xl font-bold">$9 <span class="text-base text-muted-foreground">AUD</span></div>
              <button onclick="buyPack(20)" class="px-6 py-2.5 rounded-lg border border-border bg-background hover:bg-muted text-foreground font-medium transition-all duration-300">
                Buy Pack
              </button>
            </div>
          </div>

          <!-- 50 Pack -->
          <div class="bg-background/50 border border-border rounded-lg p-5 flex items-center justify-between hover:border-primary/30 transition-all duration-300 group">
            <div class="flex items-center gap-4">
              <div>
                <div class="text-xl font-bold flex items-baseline gap-2">
                  <span class="italic">50 Iterations</span>
                  <span class="inline-flex items-center px-2.5 py-0.5 rounded text-xs font-semibold bg-green-500/20 text-green-400 border border-green-500/30 ml-2">
                    SAVE 20%
                  </span>
                </div>
              </div>
            </div>
            <div class="flex items-center gap-6">
              <div class="text-2xl font-bold text-primary">$20 <span class="text-base text-muted-foreground">AUD</span></div>
              <button onclick="buyPack(50)" class="px-6 py-2.5 rounded-lg bg-gradient-to-r from-primary to-primary-hover hover:opacity-90 text-black font-semibold transition-all duration-300">
                Buy Pack
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Get user info from URL params
    const urlParams = new URLSearchParams(window.location.search);
    const userId = urlParams.get('user_id');
    const userEmail = urlParams.get('email');
    const currentPlan = urlParams.get('plan') || 'free';

    // Update UI based on current plan
    document.addEventListener('DOMContentLoaded', () => {
      const freeBtn = document.getElementById('free-btn');
      const proBtn = document.getElementById('subscribe-btn');

      if (currentPlan === 'pro') {
        // User is on Pro plan
        freeBtn.textContent = 'Downgrade to Free';
        freeBtn.disabled = false;
        freeBtn.className = 'w-full py-3 px-6 rounded-lg border border-border bg-background hover:bg-muted text-foreground font-medium transition-all cursor-pointer';
        freeBtn.onclick = downgradeToFree;

        proBtn.textContent = 'Current Plan';
        proBtn.disabled = true;
        proBtn.className = 'w-full py-3 px-6 rounded-lg bg-muted text-muted-foreground font-semibold cursor-not-allowed';
        proBtn.onclick = null;
      } else {
        // User is on Free plan
        freeBtn.textContent = 'Current Plan';
        freeBtn.disabled = true;

        proBtn.textContent = 'Upgrade to Pro';
        proBtn.disabled = false;
      }
    });

    async function subscribeToPro() {
      if (!userId || !userEmail) {
        alert('Missing user information. Please reopen this page from the Crafter plugin.');
        return;
      }

      const btn = document.getElementById('subscribe-btn');
      btn.disabled = true;
      btn.innerHTML = `
        <div class="flex items-center justify-center gap-2">
          <svg class="animate-spin h-5 w-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
          </svg>
          <span>Loading...</span>
        </div>
      `;

      try {
        const response = await fetch('https://crafter-ai-kappa-eight.vercel.app/api/subscription?action=create-checkout', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            user_id: userId,
            user_email: userEmail,
            success_url: window.location.origin + '/success.html?type=subscription',
            cancel_url: window.location.href
          }),
        });

        const data = await response.json();

        if (data.checkout_url) {
          window.location.href = data.checkout_url;
        } else {
          throw new Error('Failed to create checkout session');
        }
      } catch (error) {
        console.error('Error:', error);
        alert('Failed to create checkout session. Please try again.');
        btn.disabled = false;
        btn.innerHTML = 'Upgrade to Pro';
      }
    }

    async function buyPack(packSize) {
      if (!userId || !userEmail) {
        alert('Missing user information. Please reopen this page from the Crafter plugin.');
        return;
      }

      try {
        const response = await fetch('https://crafter-ai-kappa-eight.vercel.app/api/subscription?action=create-pack-checkout', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            user_id: userId,
            user_email: userEmail,
            pack_size: packSize,
            success_url: window.location.origin + `/success.html?type=pack&pack_size=${packSize}`,
            cancel_url: window.location.href
          }),
        });

        const data = await response.json();

        if (data.checkout_url) {
          window.location.href = data.checkout_url;
        } else {
          throw new Error('Failed to create checkout session');
        }
      } catch (error) {
        console.error('Error:', error);
        alert('Failed to create checkout session. Please try again.');
      }
    }

    async function downgradeToFree() {
      if (!userId) {
        alert('Missing user information. Please reopen this page from the Crafter plugin.');
        return;
      }

      const confirmed = confirm(
        'Are you sure you want to downgrade to the Free plan?\n\n' +
        'Your Pro benefits will continue until the end of your current billing period, ' +
        'then you will be downgraded to:\n' +
        '• 10 iterations per month\n' +
        '• Gemini AI only\n' +
        '• Max 3 variations\n' +
        '• Single frame only'
      );

      if (!confirmed) return;

      try {
        // Open Stripe Customer Portal where user can cancel subscription
        const response = await fetch('https://crafter-ai-kappa-eight.vercel.app/api/subscription?action=portal', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            user_id: userId,
            return_url: window.location.href
          }),
        });

        const data = await response.json();

        if (data.portal_url) {
          window.location.href = data.portal_url;
        } else {
          throw new Error('Failed to open customer portal');
        }
      } catch (error) {
        console.error('Error:', error);
        alert('Failed to open subscription management. Please try again.');
      }
    }
  </script>
</body>
</html>
